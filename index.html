<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Recipes</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
:root { font-family: sans-serif; }

.category {
  padding: 5px;
  margin: 5px;
}
.category.active {
  background: #444;
  color: #fff;
}
.category.active a {
  background: #444;
  color: #fff;
}

.tag {
  padding: 5px;
  margin: 5px;
  background: #eee;
  border-radius: 5px;
  display: inline-block;
  font-size: 14px;
}
.tag.active {
  background: #444;
  color: #fff;
}
.tag.active a {
  background: #444;
  color: #fff;
}
</style>
</head>

<body>
<div id="root">
  <input type="search" id="filter-search" placeholder="Search...">
  <select id="filter-category">
    <option value="">-</option>
  </select>
  <div id="filter-tags">
    <!-- <label><input type="checkbox" value="tag-1">tag-1</label> -->
  </div>
  <div id="recipes-list"></div>
</div>


<script>
window.onload = async function () {
  const $searchInput = document.getElementById('filter-search')
  const $categorySelect = document.getElementById('filter-category')
  const $tagsContainer = document.getElementById('filter-tags')
  const $tagCheckboxes = []
  const $recipesList = document.getElementById('recipes-list')

  const recipes = await fetch('recipes.json').then((res) => res.json())
  console.log('recipes:', recipes)
  renderRecipes(recipes)

  const categories = [...new Set(recipes.map(rec => rec.category))]
  console.log('categories:', categories)

  const tags = [...new Set(recipes.flatMap(rec => rec.tags))]
  console.log('tags:', tags)

  categories.forEach(cat => {
    $categorySelect.add(new Option(cat, cat))
  })

  tags.forEach(tag => {
    const tagId = `tag_${tag.replaceAll('-', '_')}`
    const checkbox = document.createElement('input');
    checkbox.type = 'checkbox';
    checkbox.id = tagId; // Unique ID for each checkbox
    checkbox.name = 'tags'; // Common name for grouping
    checkbox.value = tag;
    $tagCheckboxes.push(checkbox)

    const label = document.createElement('label');
    label.appendChild(checkbox);
    label.appendChild(document.createTextNode(tag));

    $tagsContainer.appendChild(label);
  });

  [$searchInput, $categorySelect, ...$tagCheckboxes].forEach(el =>
    el.addEventListener('input', filterRecipes)
  );

  function filterRecipes() {
    const q = $searchInput.value.toLowerCase();
    const selectedCategory = $categorySelect.value;
    const selectedTags = Array.from($tagCheckboxes)
      .filter(c => c.checked)
      .map(c => c.value);
    console.log(q, selectedCategory, selectedTags)

    const filtered = recipes.filter(rec => {
      if (q && !rec.rawContent.toLowerCase().includes(q)) return false
      if (selectedCategory && rec.category !== selectedCategory) return false
      if (selectedTags.length > 0 && !selectedTags.every(t => rec.tags.includes(t))) return false
      return true
    });
    console.log('filtered:', filtered)
    renderRecipes(filtered)
  }

  function renderRecipes(recipes) {
    $recipesList.innerHTML = recipes.map(rec => {
      return `
        <div class="recipe-summary">
          <h4><a href="recipes/${rec.file.replace(/\.md$/, '')}">${rec.name}</a></h4>
          <span class="category">${rec.category}</span>
          <span>${rec.tags?.map(tag => `<span class="tag">${tag}</span>`).join('')}</span>
        </div>
      `
    }).join('')
  }
}
</script>
</body>
</html>
